{% extends 'base.html' %}
{% block title %}Chat Room{% endblock %}

{% block content %}
    <!-- Start section -->

    <section class="main">
        <div class="container">
            <div class="row">
                <div class="col-xs-3">
                    <p>USERS LIST</p>
                    <p>USERS LIST</p>
                    <p>USERS LIST</p>
                    <p>USERS LIST</p>
                    <p>USERS LIST</p>
                    <p>USERS LIST</p>
                    <p>USERS LIST</p>
                    <p>USERS LIST</p>
                    <p>USERS LIST</p>
                    <p>USERS LIST</p>
                    <p>USERS LIST</p>
                    <p>USERS LIST</p>
                    <p>USERS LIST</p>

                </div>
                <div class="col-xs-6">

                    <table id="chat">
                        <tbody>
                        <tr>
                        </tr>
                        </tbody>
                    </table>


                </div>
                <div class="col-xs-3">
                    <p>USER SHORT BIO</p>
                    <p>USER SHORT BIO</p>
                    <p>USER SHORT BIO</p>
                    <p>USER SHORT BIO</p>
                    <p>USER SHORT BIO</p>
                    <p>USER SHORT BIO</p>
                    <p>USER SHORT BIO</p>
                    <p>USER SHORT BIO</p>
                    <p>USER SHORT BIO</p>
                    <p>USER SHORT BIO</p>
                    <p>USER SHORT BIO</p>
                    <p>USER SHORT BIO</p>
                    <p>USER SHORT BIO</p>

                </div>
            </div>
            <form role="form" class="form-inline" id="chatform">
                <div class="row">
                    <textarea type="text" class="pull-left col-xs-11" name="message" id="message"
                              placeholder="Type your message"></textarea>
                    <input type="submit" class="btn btn-lg bold col-xs-1" value="Send"/>
                </div>
            </form>
        </div>
    </section>
    <!-- End section -->
    <script type="text/javascript" src='{% static "chat/js/jquery-1.12.1.min.js" %}'></script>
    <script type="text/javascript" src='{% static "chat/js/reconnecting-websocket.min.js" %}'></script>
    <script type='text/javascript'>
        $(document).ready(function () {
            // When we're using HTTPS, use WSS too.
            var ws_scheme = window.location.protocol == "https:" ? "wss" : "ws";
            var chatsock = new ReconnectingWebSocket(ws_scheme + '://' + window.location.host + '/chat/' + 2);
            chatsock.debug = true;
            chatsock.timeoutInterval = 3600;
            chatsock.onmessage = function (message) {
                var data = JSON.parse(message.data);
                var chat = $('#chat  > tbody:last-child');
                var ele = '<tr>' +
                        '<td>' + data.timestamp + '</td>' +
                        '<td>' + data.handle + '</td>' +
                        '<td>' + data.message + '</td>' +
                        '</tr>';
                chat.append(ele)
            };

            $("#chatform").on("submit", function (event) {
                var message = {
                    message: $('#message').val(),
                }
                chatsock.send(JSON.stringify(message));
                $("#message").val('').focus();
                return false;
            });
        });
    </script>
{% endblock %}
